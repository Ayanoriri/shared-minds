<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/p5.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/p5@1.11.11/lib/addons/p5.sound.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="utf-8" />

  </head>
  <body style="margin:0; padding:0; overflow:hidden;">
    <main style="position:absolute; left:0; top:0; height:100vh; margin:0; padding:0;">
    </main>
    <script src="palette.js"></script>
    <script src="cat.js"></script>
    <script src="llm.js"></script>
    <script src="embedding.js"></script>
    <div id="controls" style="position:fixed; right:0; top:0; bottom:0; width:50%; padding:32px; box-sizing:border-box; background:transparent; z-index:999; overflow:auto; display:flex; flex-direction:column; align-items:center; justify-content:center;">
      <label for="colorToggleInput" style="font-size:28px; font-weight:400; color:#222; display:block; margin-bottom:32px; text-align:center; line-height:1.4; max-width:100%; text-transform:lowercase;">tell me all about your cat and i can try to draw it!</label>
      <textarea id="colorToggleInput" placeholder="type here to describe your cat..." style="width:100%; max-width:400px; height:180px; font-size:16px; padding:12px; box-sizing:border-box; resize:none; font-family:inherit; font-weight:100; margin-bottom:16px; text-transform:lowercase;"></textarea>
      <div style="display:flex; gap:8px; margin-bottom:16px;">
        <button id="finishButton" style="padding:10px 24px; font-size:16px; font-family:inherit; font-weight:100; text-transform:lowercase;">draw</button>
        <button id="resetButton" style="padding:10px 24px; font-size:16px; font-family:inherit; font-weight:100; text-transform:lowercase;">meow</button>
      </div>
      <div style="display:flex; gap:8px;">
        <button id="findMatchButton" style="padding:10px 24px; font-size:16px; font-family:inherit; font-weight:100; text-transform:lowercase;">find match</button>
      </div>
    </div>
    <script>
      // Right-click the canvas to download the SVG generated by `getCatSVG()`.
      function downloadSVG(svgStr, name) {
        const blob = new Blob([svgStr], { type: 'image/svg+xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = name || 'cat.svg';
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(() => URL.revokeObjectURL(url), 1500);
      }

      function attachCanvasRightClick() {
        const canvas = document.querySelector('canvas');
        if (!canvas) { setTimeout(attachCanvasRightClick, 100); return; }
        canvas.addEventListener('contextmenu', function(e) {
          e.preventDefault();
          // prefer PNG download (with background) if available
          if (typeof window.getCatPNG === 'function') {
            window.downloadCatPNG('cat.png', { bgColor: null });
            return;
          }
          if (typeof window.getCatSVG !== 'function') return;
          const svg = window.getCatSVG({ bg: true });
          downloadSVG(svg, 'cat.svg');
        });
      }

      window.addEventListener('load', attachCanvasRightClick);
    </script>
  </body>
</html>
